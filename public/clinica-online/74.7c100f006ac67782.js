"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[74],{74:(k,v,r)=>{r.r(v),r.d(v,{TurnoAdminModule:()=>L});var f=r(6814),T=r(9517),I=r(5861),O=r(3519),h=r.n(O),e=r(5879),$=r(9113),F=r(154),N=r(588),p=r(6223),D=r(8735);function w(i,u){if(1&i&&(e.TgZ(0,"option",9),e._uU(1),e.qZA()),2&i){const t=u.$implicit;e.Q6J("value",t.uid),e.xp6(1),e.AsE("",t.apellido,", ",t.nombre,"")}}function H(i,u){if(1&i&&(e.TgZ(0,"option"),e._uU(1),e.qZA()),2&i){const t=u.$implicit;e.xp6(1),e.Oqu(t.nombre)}}function y(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"label",11),e._uU(2,"Especialidades"),e.qZA(),e.TgZ(3,"select",12),e.NdJ("ngModelChange",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.especialidadSeleccionada=o)}),e.YNc(4,H,2,1,"option",13),e.qZA(),e._UZ(5,"br"),e.TgZ(6,"div")(7,"button",14),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.buscarPorEspecialidad())}),e._uU(8,"Buscar Turno"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.especialidadSeleccionada),e.xp6(1),e.Q6J("ngForOf",t.especilidades)}}function J(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"a")(1,"button",16),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.reservarTurno(o))}),e._uU(2),e.ALo(3,"formatoHora"),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,1,t.turno),"")}}function P(i,u){if(1&i&&(e.TgZ(0,"a"),e.YNc(1,J,4,3,"a",8),e.qZA()),2&i){const t=u.$implicit,n=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.especialista.apellido==n.apellido)}}function U(i,u){if(1&i&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.YNc(3,P,2,1,"a",13),e.BQk()),2&i){const t=u.$implicit,n=e.oxw(2);e.xp6(2),e.hij("",t.apellido," - Horario de Atenci\xf3n"),e.xp6(1),e.Q6J("ngForOf",n.turnos)}}function Y(i,u){if(1&i&&(e.TgZ(0,"div",15),e.YNc(1,U,4,2,"ng-container",13),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.especialistas)}}function B(i,u){1&i&&(e.ynx(0),e._uU(1,"No hay turnos disponibles"),e.BQk())}const Q=[{path:"",component:(()=>{class i{constructor(t,n,o,s){this.turnoService=t,this.authService=n,this.router=o,this.dataquery=s,this.turnoSeleccionado={uidPaciente:"",uidEspecialista:"",fecha:"",horaInicio:"",horaFin:"",estado:"",comentarios:"",calificacion:"",especialidad:""},this.intervalo=30,this.turnosOcupados=[],this.turnos=[],this.seBusco=!1}ngOnInit(){this.turnoService.getEspecialidades().subscribe(t=>{this.especilidades=t}),this.turnoService.getTurnos().subscribe(t=>{this.turnosOcupados=t}),this.dataquery.getPacientes().then(t=>{this.pacientes=t})}formatoHora(t){return`${("0"+t.getDate()).slice(-2)}-${("0"+(t.getMonth()+1)).slice(-2)} ${("0"+t.getHours()).slice(-2)}:${("0"+t.getMinutes()).slice(-2)}`}buscarPorEspecialidad(){this.seBusco=!0,this.turnoService.getEspecialistas().subscribe(t=>{this.especialistas=[];const n=t;for(let o=0;o<n.length;o++){const c=n[o].especialidad;for(let a=0;a<c.length;a++)c[a]==this.especialidadSeleccionada&&this.especialistas.push(n[o])}this.buscarTurnos()})}buscarTurnos(){this.turnos=[],this.especialistas.forEach(t=>{this.mostrarTurnos(t.horaInicio,t.horaFin,t)}),console.log(this.turnos)}seleccionarPaciente(){this.authService.getUsuarioPorUid(this.pacienteUid).subscribe(t=>{this.pacienteSeleccionado=t,console.log(this.pacienteSeleccionado)})}mostrarTurnos(t,n,o){let s=!1,c=new Date(Date.now());c.setHours(0,0,0,0),c.setDate(c.getDate()+1);let a=new Date(c);a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1]));let l=new Date(c);if(l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1])),o.estado)for(let C=0;C<15;C++){for(let _=0;_<o.diasAtencion.length;_++){for(;a<l;){const x=new Date(a);if(x.toLocaleDateString("es-ES",{weekday:"long"}).toLowerCase()==o.diasAtencion[_].toLowerCase()){var d={turno:x,especialista:o};for(let m=0;m<this.turnosOcupados.length;m++)if(this.turnosOcupados[m].uidEspecialista==d.especialista.uid){const[S,A,b]=this.turnosOcupados[m].fecha.split("/"),[G,K]=this.turnosOcupados[m].horaInicio.split(":"),[q,z]=this.turnosOcupados[m].horaFin.split(":"),M=new Date(Number(b),Number(A)-1,Number(S),Number(G),Number(K)),Z=new Date(Number(b),Number(A)-1,Number(S),Number(q),Number(z)),g=new Date(d.turno);if(g.setMinutes(g.getMinutes()+this.intervalo),d.turno>=M&&d.turno<Z||g>M&&g<=Z){s=!0;break}}s||this.turnos.push(d),s=!1}a.setMinutes(a.getMinutes()+this.intervalo)}a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1])),l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}a.setDate(a.getDate()+1),a.setHours(0,0,0,0),l.setDate(l.getDate()+1),l.setHours(0,0,0,0),a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1])),l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}}reservarTurno(t){const n=new Date(t.turno),o=n.getDate(),s=n.getMonth()+1,c=n.getFullYear(),a=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`,l=new Date(n);l.setMinutes(l.getMinutes()+this.intervalo);const d=`${l.getHours()}:${String(l.getMinutes()).padStart(2,"0")}`;this.turnoSeleccionado.uidPaciente=this.pacienteSeleccionado[0].uid,this.turnoSeleccionado.uidEspecialista=t.especialista.uid,this.turnoSeleccionado.fecha=`${o}/${s}/${c}`,this.turnoSeleccionado.horaInicio=a,this.turnoSeleccionado.horaFin=d,this.turnoSeleccionado.estado="pendiente",this.turnoSeleccionado.especialidad=this.especialidadSeleccionada,this.confirmarTurno(this.turnoSeleccionado,t)}confirmarTurno(t,n){var s,o=this;h().fire({title:"Detalles del Turno",html:`\n        <p>Especialista: ${n.especialista.apellido}, ${n.especialista.nombre}</p>\n        <p>Paciente: ${this.pacienteSeleccionado[0].apellido}, ${this.pacienteSeleccionado[0].nombre}</p>\n        <p>Fecha: ${t.fecha}</p>\n        <p>Hora de Inicio: ${t.horaInicio}</p>\n        <p>Hora de Fin: ${t.horaFin}</p>\n      `,showCancelButton:!0,confirmButtonText:"Confirmar Turno",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:(s=(0,I.Z)(function*(){o.turnoService.crearTurno(o.turnoSeleccionado)}),function(){return s.apply(this,arguments)}),allowOutsideClick:()=>!h().isLoading()}).then(s=>{s.isConfirmed?(h().fire("\xa1Turno Confirmado!","Se confirmo el turno correctamente.","success"),this.router.navigate(["/home/admin"])):s.isDismissed&&s.dismiss===h().DismissReason.cancel&&h().fire("Cancelado","La reserva del turno fue cancelada","info")})}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36($.D),e.Y36(F.e),e.Y36(T.F0),e.Y36(N.e))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-turno-admin"]],decls:11,vars:5,consts:[[1,"container"],[1,"buscador"],[1,"paciente"],[1,"form-control",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","especialidad",4,"ngIf"],["class","contenedor",4,"ngIf"],[1,"texto-rojo"],[4,"ngIf"],[3,"value"],[1,"especialidad"],["for","specialty"],["id","specialty",1,"form-control",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[1,"btn","btn-secondary",3,"click"],[1,"contenedor"],[1,"btn","btn-outline-danger","rounded-pill","m-2",3,"click"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"label"),e._uU(4,"Seleccionar Paciente"),e.qZA(),e.TgZ(5,"select",3),e.NdJ("ngModelChange",function(c){return o.pacienteUid=c})("ngModelChange",function(){return o.seleccionarPaciente()}),e.YNc(6,w,2,3,"option",4),e.qZA()(),e.YNc(7,y,9,2,"div",5),e.YNc(8,Y,2,1,"div",6),e.TgZ(9,"div",7),e.YNc(10,B,2,0,"ng-container",8),e.qZA()()()),2&n&&(e.xp6(5),e.Q6J("ngModel",o.pacienteUid),e.xp6(1),e.Q6J("ngForOf",o.pacientes),e.xp6(1),e.Q6J("ngIf",o.pacienteSeleccionado),e.xp6(1),e.Q6J("ngIf",null!=o.especialistas),e.xp6(2),e.Q6J("ngIf",0===o.turnos.length&&o.seBusco))},dependencies:[f.sg,f.O5,p.YN,p.Kr,p.EJ,p.JJ,p.On,D.o],styles:[".buscador[_ngcontent-%COMP%]{padding:15px;border:2px solid transparent;border-radius:10px;box-shadow:0 0 10px 5px #0000004d}.container[_ngcontent-%COMP%]{padding:50px}.paciente[_ngcontent-%COMP%]{margin-bottom:25px}.texto-rojo[_ngcontent-%COMP%]{margin-top:20px;color:red}"]})}return i})(),children:[]}];let E=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[T.Bz.forChild(Q),T.Bz]})}return i})();var j=r(2514);let L=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[f.ez,E,p.u5,j.I]})}return i})()}}]);