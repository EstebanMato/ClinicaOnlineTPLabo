"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[168],{1168:(E,x,r)=>{r.r(x),r.d(x,{HomePacienteModule:()=>J});var u=r(6814),e=r(9517),C=r(5861),T=r(2572),b=r(7398),F=r(3519),i=r.n(F),n=r(8304),t=r(5879),l=r(9113),f=r(588),c=r(6223),h=r(154),p=r(5161),g=r(5258);function v(d,P){1&d&&(t.TgZ(0,"div",13),t._UZ(1,"div",14),t.qZA())}function y(d,P){if(1&d){const o=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(o);const s=t.oxw().$implicit,m=t.oxw();return t.KtG(m.cancelarTurno(s))}),t._uU(1,"Cancelar "),t.qZA()}}function I(d,P){if(1&d){const o=t.EpF();t.TgZ(0,"button",21),t.NdJ("click",function(){t.CHM(o);const s=t.oxw().$implicit,m=t.oxw();return t.KtG(m.calificarTurno(s))}),t._uU(1,"Calificar "),t.qZA()}}function O(d,P){if(1&d){const o=t.EpF();t.TgZ(0,"span")(1,"i",22),t.NdJ("click",function(){t.CHM(o);const s=t.oxw().$implicit,m=t.oxw();return t.KtG(m.verComentariosTurno(s))}),t.qZA()()}}function D(d,P){if(1&d&&(t.TgZ(0,"tr")(1,"td")(2,"p",15),t._uU(3),t.qZA()(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"primeraMayuscula"),t.qZA(),t.TgZ(11,"td")(12,"span",16),t.ALo(13,"colorPorEstado"),t._uU(14),t.ALo(15,"primeraMayuscula"),t.qZA()(),t.TgZ(16,"td"),t.YNc(17,y,2,0,"button",17),t.YNc(18,I,2,0,"button",18),t.qZA(),t.TgZ(19,"td"),t.YNc(20,O,2,0,"span",19),t.qZA()()),2&d){const o=P.$implicit;t.xp6(3),t.Oqu(o.nombreEspecialista),t.xp6(2),t.hij(" ",o.fecha," "),t.xp6(2),t.hij(" ",o.horaInicio," "),t.xp6(2),t.hij(" ",t.lcZ(10,9,o.especialidad.nombre)," "),t.xp6(3),t.Q6J("ngClass",t.lcZ(13,11,o.estado)),t.xp6(2),t.hij(" ",t.lcZ(15,13,o.estado)," "),t.xp6(3),t.Q6J("ngIf","pendiente"===o.estado||"confirmado"===o.estado),t.xp6(1),t.Q6J("ngIf","finalizado"===o.estado&&""===o.calificacion),t.xp6(2),t.Q6J("ngIf",""!==o.comentarios&&void 0!==o.comentarios||""!==o.resenia&&void 0!==o.resenia)}}const A=[{path:"",component:(()=>{class d{constructor(o,a,s,m){this.turnoService=o,this.dataquery=a,this.formBuilder=s,this.authService=m,this.isLoading=!1}ngOnInit(){this.filtroForm=this.formBuilder.group({filtrar:[""]}),this.isLoading=!0;const o=this.turnoService.getTurnos(),a=this.turnoService.getEspecialistas();this.authService.getLoggedUser().subscribe(s=>{this.usuarioLogueado=s}),(0,T.a)([o,a,this.authService.getLoggedUser()]).pipe((0,b.U)(([s,m,_])=>s.filter(Z=>Z.uidPaciente===_?.uid).map(Z=>{const L=m.find(M=>M.uid===Z.uidEspecialista);return{...Z,nombreEspecialista:L?`${L.apellido}, ${L.nombre}`:"Especialista no encontrado"}}))).subscribe(s=>{this.turnosDetallado=this.ordenarPorFecha(s),this.turnosFiltrado=this.turnosDetallado,this.isLoading=!1}),this.formSubscription=this.filtroForm.valueChanges.subscribe(s=>{this.turnosFiltrado=this.filtrarTurnos(this.turnosDetallado,s)})}ordenarPorFecha(o){return o.sort((a,s)=>{const m=this.convertirAFecha(a.fecha),_=this.convertirAFecha(s.fecha);return m.getTime()-_.getTime()}),o}convertirAFecha(o){const a=o.split("/");return new Date(parseInt(a[2]),parseInt(a[1])-1,parseInt(a[0]))}filtrarTurnos(o,a){return this.turnoService.filtrarTurnos(o,a)}getColorPorEstado(o){switch(o){case"confirmado":return"badge rounded-pill text-bg-success";case"finalizado":return"badge rounded-pill text-bg-warning";case"cancelado":case"rechazado":return"badge rounded-pill text-bg-danger";case"pendiente":return"badge rounded-pill text-bg-secondary";default:return"badge rounded-pill text-bg-muted"}}cancelarTurno(o){var s,a=this;i().fire({title:"\xbfDesea cancelar?",input:"text",inputPlaceholder:"Ingrese el motivo de la cancelaci\xf3n",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"S\xed, cancelar",showLoaderOnConfirm:!0,preConfirm:(s=(0,C.Z)(function*(m){console.log(o.id,m),a.turnoService.cancelarTurno(o.id,m)}),function(_){return s.apply(this,arguments)}),allowOutsideClick:()=>!i().isLoading()}).then(s=>{s.isConfirmed&&i().fire("Cancelado","La acci\xf3n fue cancelada.","success")})}calificarTurno(o){var s,a=this;i().fire({title:"Calificar atenci\xf3n",input:"text",html:'<input type="range" id="calificacion" name="calificacion" min="1" max="5">',inputPlaceholder:"\xbfComo estuvo la atenci\xf3n?",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Aceptar",showLoaderOnConfirm:!0,preConfirm:(s=(0,C.Z)(function*(m){const _=document.getElementById("calificacion").value;console.log(o.id,m,_),a.turnoService.calificarTurno(o.id,m,_)}),function(_){return s.apply(this,arguments)}),allowOutsideClick:()=>!i().isLoading()}).then(s=>{s.isConfirmed&&i().fire("Gracias","Se envio la calificaci\xf3n","success")})}verComentariosTurno(o){console.log(o);let a=`\n      <p><strong>Comentarios:</strong> ${o.comentarios}</p>\n      \n    `;o.datosFijos&&(""!==o.datosFijos.altura&&(a+=`\n          <p><strong>Altura:</strong> ${o.datosFijos.altura}</p>\n          `),""!==o.datosFijos.peso&&(a+=`\n          <p><strong>Peso:</strong> ${o.datosFijos.peso}</p>\n          `),""!==o.datosFijos.presion&&(a+=`\n          <p><strong>Presion:</strong> ${o.datosFijos.presion}</p>\n          `),""!==o.datosFijos.temperatura&&(a+=`\n          <p><strong>Temperatura:</strong> ${o.datosFijos.temperatura}</p>\n          `),""!==o.datosFijos.diagnostico&&(a+=`\n          <p><strong>Diagnostico:</strong> ${o.datosFijos.diagnostico}</p>\n          `)),o.datosDinamicos&&(""!==o.datosDinamicos.dato1.nombre&&(a+=`\n          <p><strong>${o.datosDinamicos.dato1.nombre}:</strong> ${o.datosDinamicos.dato1.valor}</p>\n          `),""!==o.datosDinamicos.dato2.nombre&&(a+=`\n          <p><strong>${o.datosDinamicos.dato2.nombre}:</strong> ${o.datosDinamicos.dato2.valor}</p>\n          `),""!==o.datosDinamicos.dato3.nombre&&(a+=`\n          <p><strong>${o.datosDinamicos.dato3.nombre}:</strong> ${o.datosDinamicos.dato3.valor}</p>\n          `)),""!==o.resenia&&(a+=`\n      <p><strong>Rese\xf1a:</strong> ${o.resenia}</p>\n      `),""!==o.calificacion&&(a+=`\n        <label for="calificacion">Calificaci\xf3n:</label>\n        <input type="range" id="calificacion" name="calificacion" min="1" max="5" value="${o.calificacion}" disabled>\n      `),i().fire({title:"Comentarios",html:a,confirmButtonText:"Cerrar",allowOutsideClick:()=>!i().isLoading()})}static#t=this.\u0275fac=function(a){return new(a||d)(t.Y36(l.D),t.Y36(f.e),t.Y36(c.qu),t.Y36(h.e))};static#e=this.\u0275cmp=t.Xpm({type:d,selectors:[["app-home-paciente"]],decls:32,vars:4,consts:[["class","overlay",4,"ngIf"],[1,"turnos-container"],[3,"formGroup"],[1,"filtro-container"],[1,"buscar-container"],["for","filtrar",1,"buscar-label"],[1,"input-container"],["type","text","id","filtrar","formControlName","filtrar"],[1,"fa","fa-search"],["routerLink","turno/",1,"btn-danger","btn-sm","btn-nuevo-turno"],[1,"table","table-striped","align-middle","mb-0","bg-white"],[1,"bg-light"],[4,"ngFor","ngForOf"],[1,"overlay"],[1,"spinner"],[1,"fw-normal","mb-1"],[3,"ngClass"],["type","button","class","btn btn-outline-danger btn-sm",3,"click",4,"ngIf"],["type","button","class","btn btn-outline-warning btn-sm",3,"click",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-outline-danger","btn-sm",3,"click"],["type","button",1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"fas","fa-eye","text-muted",3,"click"]],template:function(a,s){1&a&&(t.YNc(0,v,2,0,"div",0),t.TgZ(1,"div",1)(2,"form",2)(3,"div",3)(4,"div",4)(5,"label",5),t._uU(6,"Buscar:"),t.qZA(),t.TgZ(7,"div",6),t._UZ(8,"input",7)(9,"i",8),t.qZA(),t.TgZ(10,"button",9),t._uU(11,"Nuevo Turno"),t.qZA()()(),t.TgZ(12,"table",10)(13,"thead",11)(14,"tr")(15,"th"),t._uU(16,"Especialista"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Fecha"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"Hora"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"Especialidad"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Estado"),t.qZA(),t.TgZ(25,"th"),t._uU(26,"Accion"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Comentarios"),t.qZA()()(),t.TgZ(29,"tbody"),t.YNc(30,D,21,15,"tr",12),t._UZ(31,"tr"),t.qZA()()()()),2&a&&(t.Q6J("ngIf",s.isLoading),t.xp6(1),t.Q6J("@fadeInRight",void 0),t.xp6(1),t.Q6J("formGroup",s.filtroForm),t.xp6(28),t.Q6J("ngForOf",s.turnosFiltrado))},dependencies:[u.mk,u.sg,u.O5,e.rH,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,p.n,g.k],styles:[".overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#fffc;display:flex;align-items:center;justify-content:center;z-index:9999}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #e64141;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 2s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.filtro-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:10px}.btn-nuevo-turno[_ngcontent-%COMP%]{position:absolute;right:0;margin-right:60px;margin-top:5px}.turnos-container[_ngcontent-%COMP%]{margin:40px;padding:15px;border:2px solid transparent;border-radius:10px;box-shadow:0 0 10px 5px #0000004d}.buscar-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px}.input-container[_ngcontent-%COMP%]{position:relative}input[type=text][_ngcontent-%COMP%]{padding:8px 30px 8px 10px;border-radius:20px;box-shadow:2px 2px 4px #0003;border:none;outline:none;width:200px}.fa-search[_ngcontent-%COMP%]{position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#888;font-size:16px}.buscar-label[_ngcontent-%COMP%]{font-size:18px;margin-right:10px;font-weight:700}"],data:{animation:[n.M]}})}return d})(),children:[]},{path:"turno",loadChildren:()=>Promise.all([r.e(592),r.e(17)]).then(r.bind(r,17)).then(d=>d.TurnoPacienteModule)}];let S=(()=>{class d{static#t=this.\u0275fac=function(a){return new(a||d)};static#e=this.\u0275mod=t.oAB({type:d});static#o=this.\u0275inj=t.cJS({imports:[u.ez,e.Bz.forChild(A),e.Bz]})}return d})();var w=r(2514);let J=(()=>{class d{static#t=this.\u0275fac=function(a){return new(a||d)};static#e=this.\u0275mod=t.oAB({type:d});static#o=this.\u0275inj=t.cJS({imports:[u.ez,S,c.u5,c.UX,w.I]})}return d})()},588:(E,x,r)=>{r.d(x,{e:()=>T});var u=r(5861),e=r(5349),C=r(5879);let T=(()=>{class b{constructor(i){this.firestore=i}getObraSociales(){const i=(0,e.hJ)(this.firestore,"obrasSociales");return(0,e.BS)(i)}getEspecialidades(){const i=(0,e.hJ)(this.firestore,"especialidades");return(0,e.BS)(i)}getProxIdEspecialidades(){var i=this;return(0,u.Z)(function*(){const n=(0,e.hJ)(i.firestore,"especialidades"),t=(0,e.IO)(n,(0,e.Xo)("id","desc")),l=yield(0,e.PL)(t);return l.empty?1:l.docs[0].get("id")+1})()}altaEspecialidad(i){var n=this;return(0,u.Z)(function*(){const t=yield n.getProxIdEspecialidades(),l=(0,e.hJ)(n.firestore,"especialidades");(0,e.ET)(l,{id:t,nombre:i.toLowerCase()})})()}traerUsuarios(){const i=(0,e.hJ)(this.firestore,"usuarios");return(0,e.BS)(i)}getPacientes(){var i=this;return(0,u.Z)(function*(){const n=(0,e.hJ)(i.firestore,"usuarios"),t=(0,e.IO)(n,(0,e.ar)("perfil","==","paciente")),l=yield(0,e.PL)(t),f=[];return l.forEach(c=>{f.push(c.data())}),f})()}cambiarEstadoUsuario(i,n){var t=this;return(0,u.Z)(function*(){const l=(0,e.hJ)(t.firestore,"usuarios"),f=(0,e.IO)(l,(0,e.ar)("uid","==",i)),c=yield(0,e.PL)(f);return 0!==c.size&&(c.forEach(function(){var h=(0,u.Z)(function*(p){const g=p.ref;yield(0,e.pl)(g,{estado:n},{merge:!0})});return function(p){return h.apply(this,arguments)}}()),!0)})()}setHorarios(i,n,t,l){var f=this;return(0,u.Z)(function*(){const c=(0,e.hJ)(f.firestore,"usuarios"),h=(0,e.IO)(c,(0,e.ar)("uid","==",i.uid)),p=yield(0,e.PL)(h);return 0!==p.size&&(p.forEach(function(){var g=(0,u.Z)(function*(v){const y=v.ref;yield(0,e.pl)(y,{diasAtencion:n,horaInicio:t,horaFin:l},{merge:!0})});return function(v){return g.apply(this,arguments)}}()),!0)})()}static#t=this.\u0275fac=function(n){return new(n||b)(C.LFG(e.gg))};static#e=this.\u0275prov=C.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()},9113:(E,x,r)=>{r.d(x,{D:()=>T});var u=r(5861),e=r(5349),C=r(5879);let T=(()=>{class b{constructor(i){this.firestore=i}getEspecialidades(){const i=(0,e.hJ)(this.firestore,"especialidades");return(0,e.BS)(i)}getEspecialistas(){const i=(0,e.hJ)(this.firestore,"usuarios"),n=(0,e.IO)(i,(0,e.ar)("perfil","==","especialista"),(0,e.ar)("estado","==",!0));return(0,e.BS)(n)}getPacientes(){const i=(0,e.hJ)(this.firestore,"usuarios"),n=(0,e.IO)(i,(0,e.ar)("perfil","==","paciente"),(0,e.ar)("estado","==",!0));return(0,e.BS)(n)}getTurnos(){const i=(0,e.hJ)(this.firestore,"turnos");return(0,e.BS)(i)}getTurnosPendientes(){const i=(0,e.hJ)(this.firestore,"turnos"),n=(0,e.IO)(i,(0,e.ar)("estado","==","pendiente"));return(0,e.BS)(n)}getTurnosFinalizados(){const i=(0,e.hJ)(this.firestore,"turnos"),n=(0,e.IO)(i,(0,e.ar)("estado","==","finalizado"));return(0,e.BS)(n)}getTurnosActivos(){const i=(0,e.hJ)(this.firestore,"turnos"),n=(0,e.IO)(i,(0,e.ar)("estado","!=","cancelado"));return(0,e.BS)(n)}crearTurno(i){var n=this;return(0,u.Z)(function*(){const t=yield n.getProxIdTurno(),l=(0,e.hJ)(n.firestore,"turnos");(0,e.ET)(l,{id:t,uidPaciente:i.uidPaciente,uidEspecialista:i.uidEspecialista,estado:i.estado,fecha:i.fecha,horaFin:i.horaFin,horaInicio:i.horaInicio,comentarios:i.comentarios,calificacion:i.calificacion,especialidad:i.especialidad,resenia:""})})()}getProxIdTurno(){var i=this;return(0,u.Z)(function*(){const n=(0,e.hJ)(i.firestore,"turnos"),t=(0,e.IO)(n,(0,e.Xo)("id","desc")),l=yield(0,e.PL)(t);return l.empty?1:l.docs[0].get("id")+1})()}cancelarTurno(i,n){var t=this;return(0,u.Z)(function*(){const l=(0,e.hJ)(t.firestore,"turnos"),f=(0,e.IO)(l,(0,e.ar)("id","==",i)),c=yield(0,e.PL)(f);return 0!==c.size&&(c.forEach(function(){var h=(0,u.Z)(function*(p){const g=p.ref;yield(0,e.pl)(g,{estado:"cancelado",comentarios:n},{merge:!0})});return function(p){return h.apply(this,arguments)}}()),!0)})()}finalizarTurno(i,n,t,l){var f=this;return(0,u.Z)(function*(){const c=(0,e.hJ)(f.firestore,"turnos"),h=(0,e.IO)(c,(0,e.ar)("id","==",i)),p=yield(0,e.PL)(h);return 0!==p.size&&(p.forEach(function(){var g=(0,u.Z)(function*(v){const y=v.ref;yield(0,e.pl)(y,{estado:"finalizado",comentarios:l,datosFijos:n,datosDinamicos:t},{merge:!0})});return function(v){return g.apply(this,arguments)}}()),!0)})()}confirmarTurno(i){var n=this;return(0,u.Z)(function*(){const t=(0,e.hJ)(n.firestore,"turnos"),l=(0,e.IO)(t,(0,e.ar)("id","==",i)),f=yield(0,e.PL)(l);return 0!==f.size&&(f.forEach(function(){var c=(0,u.Z)(function*(h){const p=h.ref;yield(0,e.pl)(p,{estado:"confirmado"},{merge:!0})});return function(h){return c.apply(this,arguments)}}()),!0)})()}calificarTurno(i,n,t){var l=this;return(0,u.Z)(function*(){const f=(0,e.hJ)(l.firestore,"turnos"),c=(0,e.IO)(f,(0,e.ar)("id","==",i)),h=yield(0,e.PL)(c);return 0!==h.size&&(h.forEach(function(){var p=(0,u.Z)(function*(g){const v=g.ref;yield(0,e.pl)(v,{resenia:n,calificacion:t},{merge:!0})});return function(g){return p.apply(this,arguments)}}()),!0)})()}filtrarTurnos(i,n){return i&&"string"==typeof n.filtrar?i.filter(t=>{const l="string"==typeof t.especialidad.nombre&&t.especialidad.nombre.toLowerCase().includes(n.filtrar?.toLowerCase()),f=t.nombreEspecialista&&"string"==typeof t.nombreEspecialista&&t.nombreEspecialista.toLowerCase().includes(n.filtrar?.toLowerCase()),c=t.nombrePaciente&&"string"==typeof t.nombrePaciente&&t.nombrePaciente.toLowerCase().includes(n.filtrar?.toLowerCase()),h="string"==typeof t.fecha&&t.fecha.toLowerCase().includes(n.filtrar?.toLowerCase()),p="string"==typeof t.horaInicio&&t.horaInicio.toLowerCase().includes(n.filtrar?.toLowerCase()),g="string"==typeof t.estado&&t.estado.toLowerCase().includes(n.filtrar?.toLowerCase()),v=t.datosDinamicos&&("string"==typeof t.datosDinamicos.dato1?.nombre&&t.datosDinamicos.dato1.nombre.toLowerCase().includes(n.filtrar?.toLowerCase())||"string"==typeof t.datosDinamicos.dato2?.nombre&&t.datosDinamicos.dato2.nombre.toLowerCase().includes(n.filtrar?.toLowerCase())||"string"==typeof t.datosDinamicos.dato3?.nombre&&t.datosDinamicos.dato3.nombre.toLowerCase().includes(n.filtrar?.toLowerCase())||"string"==typeof t.datosDinamicos.dato1?.valor&&t.datosDinamicos.dato1.valor.toLowerCase().includes(n.filtrar?.toLowerCase())||"string"==typeof t.datosDinamicos.dato2?.valor&&t.datosDinamicos.dato2.valor.toLowerCase().includes(n.filtrar?.toLowerCase())||"string"==typeof t.datosDinamicos.dato3?.valor&&t.datosDinamicos.dato3.valor.toLowerCase().includes(n.filtrar?.toLowerCase())),y=t.datosFijos&&("number"==typeof t.datosFijos.altura&&t.datosFijos.altura.toString().includes(n.filtrar)||"string"==typeof t.datosFijos.diagnostico&&t.datosFijos.diagnostico.toLowerCase().includes(n.filtrar?.toLowerCase())||"number"==typeof t.datosFijos.peso&&t.datosFijos.peso.toString().includes(n.filtrar)||"number"==typeof t.datosFijos.presion&&t.datosFijos.presion.toString().includes(n.filtrar)||"number"==typeof t.datosFijos.temperatura&&t.datosFijos.temperatura.toString().includes(n.filtrar));return l||c||f||h||p||g||v||y}):[]}static#t=this.\u0275fac=function(n){return new(n||b)(C.LFG(e.gg))};static#e=this.\u0275prov=C.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()}}]);