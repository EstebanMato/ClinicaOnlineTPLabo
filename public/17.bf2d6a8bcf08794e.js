"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[17],{17:(U,x,r)=>{r.r(x),r.d(x,{TurnoPacienteModule:()=>j});var f=r(6814),h=r(9517),P=r(5861),S=r(3519),g=r.n(S),t=r(5879),y=r(9113),D=r(154),I=r(8735);function F(i,p){if(1&i){const e=t.EpF();t.TgZ(0,"div",8)(1,"button",9),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.mostrarEspecialidades(a))}),t._UZ(2,"img",10),t.qZA(),t.TgZ(3,"p")(4,"strong"),t._uU(5),t.qZA()()()}if(2&i){const e=p.$implicit;t.xp6(2),t.hYB("alt","Imagen de ",e.nombre," ",e.apellido,""),t.Q6J("src",e.imagen,t.LSH),t.xp6(3),t.AsE("",e.apellido,", ",e.nombre,"")}}function $(i,p){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",11)(2,"button",12),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.buscarTurnos(o))}),t.TgZ(3,"img",13),t.NdJ("error",function(o){t.CHM(e);const a=t.oxw(3);return t.KtG(a.mostrarImagenPorDefecto(o))}),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA()()(),t.BQk()}if(2&i){const e=t.oxw().$implicit;t.xp6(3),t.MGl("alt","Imagen de ",e.nombre,""),t.Q6J("src",e.img,t.LSH),t.xp6(2),t.Oqu(e.nombre)}}function H(i,p){if(1&i&&(t.ynx(0),t.YNc(1,$,6,3,"ng-container",7),t.BQk()),2&i){const e=p.$implicit,n=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",n==e.nombre)}}function N(i,p){if(1&i&&(t.ynx(0),t.YNc(1,H,2,1,"ng-container",5),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.especialidades)}}function Z(i,p){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",14),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.reservarTurno(a))}),t._uU(2),t.ALo(3,"formatoHora"),t.qZA(),t.BQk()}if(2&i){const e=p.$implicit;t.xp6(2),t.hij(" ",t.lcZ(3,1,e.turno)," ")}}function A(i,p){if(1&i&&(t.ynx(0),t.YNc(1,Z,4,3,"ng-container",5),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.turnos)}}const J=[{path:"",component:(()=>{class i{constructor(e,n,o){this.turnoService=e,this.authService=n,this.router=o,this.turnoSeleccionado={uidPaciente:"",uidEspecialista:"",fecha:"",horaInicio:"",horaFin:"",estado:"",comentarios:"",calificacion:"",especialidad:""},this.turnosOcupados=[],this.intervalo=30,this.turnos=[]}ngOnInit(){this.turnoService.getEspecialidades().subscribe(e=>{this.especialidades=e}),this.authService.getLoggedUser().subscribe(e=>{this.paciente=e}),this.turnoService.getTurnos().subscribe(e=>{this.turnosOcupados=e}),this.turnoService.getEspecialistas().subscribe(e=>{this.especialistas=e})}mostrarEspecialidades(e){this.turnos=[],this.especialistaSeleccionado=e,this.especialidadesDisponibles=e.especialidad}mostrarImagenPorDefecto(e){e.target.src="https://firebasestorage.googleapis.com/v0/b/clinicaonlineutn.appspot.com/o/especialidades%2Ffarmacia.png?alt=media&token=91fb52dd-8578-4f52-aaf3-365695e02266"}buscarTurnos(e){this.especialidadSeleccionada=e,this.turnos=[],this.mostrarTurnos(this.especialistaSeleccionado.horaInicio,this.especialistaSeleccionado.horaFin,this.especialistaSeleccionado)}mostrarTurnos(e,n,o){let a=!1,s=new Date(Date.now());s.setHours(0,0,0,0),s.setDate(s.getDate()+1);let c=new Date(s);c.setHours(parseInt(e.split(":")[0]),parseInt(e.split(":")[1]));let l=new Date(s);if(l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1])),o.estado)for(let C=0;C<15;C++){for(let _=0;_<o.diasAtencion.length;_++){for(;c<l;){const T=new Date(c);if(T.toLocaleDateString("es-ES",{weekday:"long"}).toLowerCase()==o.diasAtencion[_].toLowerCase()){var u={turno:T,especialista:o};for(let d=0;d<this.turnosOcupados.length;d++)if(this.turnosOcupados[d].uidEspecialista==u.especialista.uid){const[b,v,w]=this.turnosOcupados[d].fecha.split("/"),[Y,L]=this.turnosOcupados[d].horaInicio.split(":"),[E,G]=this.turnosOcupados[d].horaFin.split(":"),M=new Date(Number(w),Number(v)-1,Number(b),Number(Y),Number(L)),O=new Date(Number(w),Number(v)-1,Number(b),Number(E),Number(G)),m=new Date(u.turno);if(m.setMinutes(m.getMinutes()+this.intervalo),u.turno>=M&&u.turno<O||m>M&&m<=O){a=!0;break}}a||this.turnos.push(u),a=!1}c.setMinutes(c.getMinutes()+this.intervalo)}c.setHours(parseInt(e.split(":")[0]),parseInt(e.split(":")[1])),l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}c.setDate(c.getDate()+1),c.setHours(0,0,0,0),l.setDate(l.getDate()+1),l.setHours(0,0,0,0),c.setHours(parseInt(e.split(":")[0]),parseInt(e.split(":")[1])),l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}}formatoHora(e){return`${("0"+e.getDate()).slice(-2)}-${("0"+(e.getMonth()+1)).slice(-2)} ${("0"+e.getHours()).slice(-2)}:${("0"+e.getMinutes()).slice(-2)}`}reservarTurno(e){const n=new Date(e.turno),o=n.getDate(),a=n.getMonth()+1,s=n.getFullYear(),c=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`,l=new Date(n);l.setMinutes(l.getMinutes()+this.intervalo);const u=`${l.getHours()}:${String(l.getMinutes()).padStart(2,"0")}`;this.turnoSeleccionado.uidPaciente=this.paciente.uid,this.turnoSeleccionado.uidEspecialista=e.especialista.uid,this.turnoSeleccionado.fecha=`${o}/${a}/${s}`,this.turnoSeleccionado.horaInicio=c,this.turnoSeleccionado.horaFin=u,this.turnoSeleccionado.estado="pendiente",this.turnoSeleccionado.especialidad=this.especialidadSeleccionada,this.confirmarTurno(this.turnoSeleccionado,e)}confirmarTurno(e,n){var a,o=this;g().fire({title:"Detalles del Turno",html:`\n        <p>Especialista: ${n.especialista.apellido}, ${n.especialista.nombre}</p>\n        <p>Fecha: ${e.fecha}</p>\n        <p>Hora de Inicio: ${e.horaInicio}</p>\n        <p>Hora de Fin: ${e.horaFin}</p>\n      `,showCancelButton:!0,confirmButtonText:"Confirmar Turno",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:(a=(0,P.Z)(function*(){o.turnoService.crearTurno(o.turnoSeleccionado)}),function(){return a.apply(this,arguments)}),allowOutsideClick:()=>!g().isLoading()}).then(a=>{a.isConfirmed?(g().fire("\xa1Turno Confirmado!","Se confirmo el turno correctamente.","success"),this.router.navigate(["/home/paciente"])):a.isDismissed&&a.dismiss===g().DismissReason.cancel&&g().fire("Cancelado","La reserva del turno fue cancelada","info")})}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(y.D),t.Y36(D.e),t.Y36(h.F0))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-turno-paciente"]],decls:8,vars:3,consts:[[1,"container"],[1,"container-turno"],[1,"container-especialistas"],["class","especialista-item",4,"ngFor","ngForOf"],[1,"imagenes-container"],[4,"ngFor","ngForOf"],[1,"turnos-container"],[4,"ngIf"],[1,"especialista-item"],["type","button",1,"btn","btn-dark","no-padding",3,"click"],[1,"full-image",3,"src","alt"],[1,"image-wrapper"],["type","button",1,"image-button",3,"click"],[1,"rounded-circle",3,"src","alt","error"],[1,"btn","btn-outline-danger","rounded-pill","m-2",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t.YNc(3,F,6,5,"div",3),t.qZA(),t.TgZ(4,"div",4),t.YNc(5,N,2,1,"ng-container",5),t.qZA(),t.TgZ(6,"div",6),t.YNc(7,A,2,1,"ng-container",7),t.qZA()()()),2&n&&(t.xp6(3),t.Q6J("ngForOf",o.especialistas),t.xp6(2),t.Q6J("ngForOf",o.especialidadesDisponibles),t.xp6(2),t.Q6J("ngIf",o.turnos))},dependencies:[f.sg,f.O5,I.o],styles:[".container-especialistas[_ngcontent-%COMP%]{display:flex;gap:.8rem;margin-top:2rem;flex-wrap:wrap;justify-content:center}.especialista-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;width:100px}.btn[_ngcontent-%COMP%]{width:80px;height:60px;display:flex;align-items:center;justify-content:center;padding:0;border-radius:5px}.no-padding[_ngcontent-%COMP%]{padding:0!important}.full-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:5px;margin:0}.imagenes-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:20px}.image-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.image-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;object-fit:cover;margin-bottom:5px}.image-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;flex-direction:column;align-items:center;text-align:center}.image-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;object-fit:cover;margin-bottom:5px}.turnos-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;padding:10px}.turnos-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:0 0 auto;white-space:wrap}.container-turno[_ngcontent-%COMP%]{margin:40px;padding:15px;border:2px solid transparent;border-radius:10px;box-shadow:0 0 10px 5px #0000004d}"]})}return i})(),children:[]}];let B=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#n=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(J),h.Bz]})}return i})();var Q=r(6223),k=r(2514);let j=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#n=this.\u0275inj=t.cJS({imports:[f.ez,B,Q.u5,k.I]})}return i})()}}]);