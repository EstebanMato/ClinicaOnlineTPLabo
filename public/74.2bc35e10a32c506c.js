"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[74],{74:(G,v,r)=>{r.r(v),r.d(v,{TurnoAdminModule:()=>P});var g=r(6814),T=r(9517),I=r(5861),Z=r(3519),m=r.n(Z),e=r(5879),w=r(9113),D=r(154),N=r(588),p=r(6223);function O(i,u){if(1&i&&(e.TgZ(0,"option",6),e._uU(1),e.qZA()),2&i){const t=u.$implicit;e.Q6J("value",t.uid),e.xp6(1),e.AsE("",t.apellido,", ",t.nombre,"")}}function $(i,u){if(1&i&&(e.TgZ(0,"option"),e._uU(1),e.qZA()),2&i){const t=u.$implicit;e.xp6(1),e.Oqu(t.nombre)}}function J(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"div",7)(1,"label",8),e._uU(2,"Especialidades"),e.qZA(),e.TgZ(3,"select",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.especialidadSeleccionada=o)}),e.YNc(4,$,2,1,"option",10),e.qZA(),e.TgZ(5,"button",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.buscarPorEspecialidad())}),e._uU(6,"Buscar Turno"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.especialidadSeleccionada),e.xp6(1),e.Q6J("ngForOf",t.especilidades)}}function H(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"a")(1,"button",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.reservarTurno(o))}),e._uU(2),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.turno,"")}}function y(i,u){if(1&i&&(e.TgZ(0,"a"),e.YNc(1,H,3,1,"a",13),e.qZA()),2&i){const t=u.$implicit,n=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.especialista.apellido==n.apellido)}}function Y(i,u){if(1&i&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.YNc(3,y,2,1,"a",10),e.BQk()),2&i){const t=u.$implicit,n=e.oxw(2);e.xp6(2),e.hij("",t.apellido," - Horario de Atenci\xf3n"),e.xp6(1),e.Q6J("ngForOf",n.turnos)}}function U(i,u){if(1&i&&(e.TgZ(0,"div",12),e.YNc(1,Y,4,2,"ng-container",10),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.especialistas)}}const E=[{path:"",component:(()=>{class i{constructor(t,n,o,s){this.turnoService=t,this.authService=n,this.router=o,this.dataquery=s,this.turnoSeleccionado={uidPaciente:"",uidEspecialista:"",fecha:"",horaInicio:"",horaFin:"",estado:"",comentarios:"",calificacion:"",especialidad:""},this.intervalo=30,this.turnosOcupados=[],this.turnos=[]}ngOnInit(){this.turnoService.getEspecialidades().subscribe(t=>{this.especilidades=t}),this.turnoService.getTurnos().subscribe(t=>{this.turnosOcupados=t}),this.dataquery.getPacientes().then(t=>{this.pacientes=t})}buscarPorEspecialidad(){this.turnoService.getEspecialistas().subscribe(t=>{this.especialistas=[];const n=t;for(let o=0;o<n.length;o++){const c=n[o].especialidad;for(let a=0;a<c.length;a++)c[a]==this.especialidadSeleccionada&&this.especialistas.push(n[o])}this.buscarTurnos()})}buscarTurnos(){this.turnos=[],this.especialistas.forEach(t=>{this.mostrarTurnos(t.horaInicio,t.horaFin,t)})}seleccionarPaciente(){this.authService.getUsuarioPorUid(this.pacienteUid).subscribe(t=>{this.pacienteSeleccionado=t,console.log(this.pacienteSeleccionado)})}mostrarTurnos(t,n,o){let s=!1,c=new Date(Date.now());c.setHours(0,0,0,0),c.setDate(c.getDate()+1);let a=new Date(c);a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1]));let l=new Date(c);if(l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1])),o.estado)for(let C=0;C<15;C++){for(let _=0;_<o.diasAtencion.length;_++){for(;a<l;){const S=new Date(a);if(S.toLocaleDateString("es-ES",{weekday:"long"}).toLowerCase()==o.diasAtencion[_].toLowerCase()){var d={turno:S,especialista:o};for(let h=0;h<this.turnosOcupados.length;h++)if(this.turnosOcupados[h].uidEspecialista==d.especialista.uid){const[A,x,M]=this.turnosOcupados[h].fecha.split("/"),[B,j]=this.turnosOcupados[h].horaInicio.split(":"),[L,q]=this.turnosOcupados[h].horaFin.split(":"),b=new Date(Number(M),Number(x)-1,Number(A),Number(B),Number(j)),F=new Date(Number(M),Number(x)-1,Number(A),Number(L),Number(q)),f=new Date(d.turno);if(f.setMinutes(f.getMinutes()+this.intervalo),d.turno>=b&&d.turno<F||f>b&&f<=F){s=!0;break}}s||this.turnos.push(d),s=!1}a.setMinutes(a.getMinutes()+this.intervalo)}a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1])),l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}a.setDate(a.getDate()+1),a.setHours(0,0,0,0),l.setDate(l.getDate()+1),l.setHours(0,0,0,0),a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1])),l.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}}reservarTurno(t){const n=new Date(t.turno),o=n.getDate(),s=n.getMonth()+1,c=n.getFullYear(),a=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`,l=new Date(n);l.setMinutes(l.getMinutes()+this.intervalo);const d=`${l.getHours()}:${String(l.getMinutes()).padStart(2,"0")}`;this.turnoSeleccionado.uidPaciente=this.pacienteSeleccionado[0].uid,this.turnoSeleccionado.uidEspecialista=t.especialista.uid,this.turnoSeleccionado.fecha=`${o}/${s}/${c}`,this.turnoSeleccionado.horaInicio=a,this.turnoSeleccionado.horaFin=d,this.turnoSeleccionado.estado="pendiente",this.turnoSeleccionado.especialidad=this.especialidadSeleccionada,this.confirmarTurno(this.turnoSeleccionado,t)}confirmarTurno(t,n){var s,o=this;m().fire({title:"Detalles del Turno",html:`\n        <p>Especialista: ${n.especialista.apellido}, ${n.especialista.nombre}</p>\n        <p>Paciente: ${this.pacienteSeleccionado[0].apellido}, ${this.pacienteSeleccionado[0].nombre}</p>\n        <p>Fecha: ${t.fecha}</p>\n        <p>Hora de Inicio: ${t.horaInicio}</p>\n        <p>Hora de Fin: ${t.horaFin}</p>\n      `,showCancelButton:!0,confirmButtonText:"Confirmar Turno",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:(s=(0,I.Z)(function*(){o.turnoService.crearTurno(o.turnoSeleccionado)}),function(){return s.apply(this,arguments)}),allowOutsideClick:()=>!m().isLoading()}).then(s=>{s.isConfirmed?(m().fire("\xa1Turno Confirmado!","Se confirmo el turno correctamente.","success"),this.router.navigate(["/home/admin"])):s.isDismissed&&s.dismiss===m().DismissReason.cancel&&m().fire("Cancelado","La reserva del turno fue cancelada","info")})}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(w.D),e.Y36(D.e),e.Y36(T.F0),e.Y36(N.e))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-turno-admin"]],decls:8,vars:4,consts:[[1,"container"],[1,"paciente"],[1,"form-control",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","especialidad",4,"ngIf"],["class","contenedor",4,"ngIf"],[3,"value"],[1,"especialidad"],["for","specialty"],["id","specialty",1,"form-control",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"click"],[1,"contenedor"],[4,"ngIf"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label"),e._uU(3,"Seleccionar Paciente"),e.qZA(),e.TgZ(4,"select",2),e.NdJ("ngModelChange",function(c){return o.pacienteUid=c})("ngModelChange",function(){return o.seleccionarPaciente()}),e.YNc(5,O,2,3,"option",3),e.qZA()(),e.YNc(6,J,7,2,"div",4),e.YNc(7,U,2,1,"div",5),e.qZA()),2&n&&(e.xp6(4),e.Q6J("ngModel",o.pacienteUid),e.xp6(1),e.Q6J("ngForOf",o.pacientes),e.xp6(1),e.Q6J("ngIf",o.pacienteSeleccionado),e.xp6(1),e.Q6J("ngIf",null!=o.especialistas))},dependencies:[g.sg,g.O5,p.YN,p.Kr,p.EJ,p.JJ,p.On]})}return i})(),children:[]}];let Q=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[T.Bz.forChild(E),T.Bz]})}return i})(),P=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[g.ez,Q,p.u5]})}return i})()}}]);