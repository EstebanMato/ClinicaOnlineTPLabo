"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[17],{17:(j,_,u)=>{u.r(_),u.d(_,{TurnoPacienteModule:()=>Y});var g=u(6814),T=u(9517),M=u(5861),N=u(3519),f=u.n(N),e=u(5879),O=u(9113),x=u(154),d=u(6223);function P(i,l){if(1&i&&(e.TgZ(0,"option"),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.xp6(1),e.Oqu(t.nombre)}}function Z(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"a")(1,"button",5),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.reservarTurno(o))}),e._uU(2),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.turno,"")}}function $(i,l){if(1&i&&(e.TgZ(0,"a"),e.YNc(1,Z,3,1,"a",8),e.qZA()),2&i){const t=l.$implicit,n=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.especialista.apellido==n.apellido)}}function H(i,l){if(1&i&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.YNc(3,$,2,1,"a",4),e.BQk()),2&i){const t=l.$implicit,n=e.oxw(2);e.xp6(2),e.hij("",t.apellido," - Horario de Atenci\xf3n"),e.xp6(1),e.Q6J("ngForOf",n.turnos)}}function A(i,l){if(1&i&&(e.TgZ(0,"div",7),e.YNc(1,H,4,2,"ng-container",4),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.especialistas)}}const J=[{path:"",component:(()=>{class i{constructor(t,n,o){this.turnoService=t,this.authService=n,this.router=o,this.turnoSeleccionado={uidPaciente:"",uidEspecialista:"",fecha:"",horaInicio:"",horaFin:"",estado:"",comentarios:"",calificacion:"",especialidad:""},this.intervalo=30,this.turnosOcupados=[],this.turnos=[]}ngOnInit(){this.turnoService.getEspecialidades().subscribe(t=>{this.especilidades=t}),this.authService.getLoggedUser().subscribe(t=>{this.paciente=t}),this.turnoService.getTurnos().subscribe(t=>{this.turnosOcupados=t})}buscarPorEspecialidad(){this.turnoService.getEspecialistas().subscribe(t=>{this.especialistas=[];const n=t;for(let o=0;o<n.length;o++){const c=n[o].especialidad;for(let a=0;a<c.length;a++)c[a]==this.especialidadSeleccionada&&this.especialistas.push(n[o])}this.buscarTurnos()})}buscarTurnos(){this.turnos=[],this.especialistas.forEach(t=>{this.mostrarTurnos(t.horaInicio,t.horaFin,t)})}mostrarTurnos(t,n,o){let s=!1,c=new Date(Date.now());c.setHours(0,0,0,0),c.setDate(c.getDate()+1);let a=new Date(c);a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1]));let r=new Date(c);if(r.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1])),o.estado)for(let S=0;S<15;S++){for(let v=0;v<o.diasAtencion.length;v++){for(;a<r;){const C=new Date(a);if(C.toLocaleDateString("es-ES",{weekday:"long"}).toLowerCase()==o.diasAtencion[v].toLowerCase()){var p={turno:C,especialista:o};for(let h=0;h<this.turnosOcupados.length;h++)if(this.turnosOcupados[h].uidEspecialista==p.especialista.uid){const[b,D,I]=this.turnosOcupados[h].fecha.split("/"),[B,E]=this.turnosOcupados[h].horaInicio.split(":"),[L,Q]=this.turnosOcupados[h].horaFin.split(":"),w=new Date(Number(I),Number(D)-1,Number(b),Number(B),Number(E)),F=new Date(Number(I),Number(D)-1,Number(b),Number(L),Number(Q)),m=new Date(p.turno);if(m.setMinutes(m.getMinutes()+this.intervalo),p.turno>=w&&p.turno<F||m>w&&m<=F){s=!0;break}}s||this.turnos.push(p),s=!1}a.setMinutes(a.getMinutes()+this.intervalo)}a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1])),r.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}a.setDate(a.getDate()+1),a.setHours(0,0,0,0),r.setDate(r.getDate()+1),r.setHours(0,0,0,0),a.setHours(parseInt(t.split(":")[0]),parseInt(t.split(":")[1])),r.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]))}}reservarTurno(t){const n=new Date(t.turno),o=n.getDate(),s=n.getMonth()+1,c=n.getFullYear(),a=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`,r=new Date(n);r.setMinutes(r.getMinutes()+this.intervalo);const p=`${r.getHours()}:${String(r.getMinutes()).padStart(2,"0")}`;this.turnoSeleccionado.uidPaciente=this.paciente.uid,this.turnoSeleccionado.uidEspecialista=t.especialista.uid,this.turnoSeleccionado.fecha=`${o}/${s}/${c}`,this.turnoSeleccionado.horaInicio=a,this.turnoSeleccionado.horaFin=p,this.turnoSeleccionado.estado="pendiente",this.turnoSeleccionado.especialidad=this.especialidadSeleccionada,this.confirmarTurno(this.turnoSeleccionado,t)}confirmarTurno(t,n){var s,o=this;f().fire({title:"Detalles del Turno",html:`\n        <p>Especialista: ${n.especialista.apellido}, ${n.especialista.nombre}</p>\n        <p>Fecha: ${t.fecha}</p>\n        <p>Hora de Inicio: ${t.horaInicio}</p>\n        <p>Hora de Fin: ${t.horaFin}</p>\n      `,showCancelButton:!0,confirmButtonText:"Confirmar Turno",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:(s=(0,M.Z)(function*(){o.turnoService.crearTurno(o.turnoSeleccionado)}),function(){return s.apply(this,arguments)}),allowOutsideClick:()=>!f().isLoading()}).then(s=>{s.isConfirmed?(f().fire("\xa1Turno Confirmado!","Se confirmo el turno correctamente.","success"),this.router.navigate(["/home/paciente"])):s.isDismissed&&s.dismiss===f().DismissReason.cancel&&f().fire("Cancelado","La reserva del turno fue cancelada","info")})}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(O.D),e.Y36(x.e),e.Y36(T.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-turno-paciente"]],decls:9,vars:3,consts:[[1,"container"],[1,"especialidad"],["for","specialty"],["id","specialty",1,"form-control",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"click"],["class","contenedor",4,"ngIf"],[1,"contenedor"],[4,"ngIf"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"Especialidades"),e.qZA(),e.TgZ(4,"select",3),e.NdJ("ngModelChange",function(c){return o.especialidadSeleccionada=c}),e.YNc(5,P,2,1,"option",4),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return o.buscarPorEspecialidad()}),e._uU(7,"Buscar Turno"),e.qZA()(),e.YNc(8,A,2,1,"div",6),e.qZA()),2&n&&(e.xp6(4),e.Q6J("ngModel",o.especialidadSeleccionada),e.xp6(1),e.Q6J("ngForOf",o.especilidades),e.xp6(3),e.Q6J("ngIf",null!=o.especialistas))},dependencies:[g.sg,g.O5,d.YN,d.Kr,d.EJ,d.JJ,d.On]})}return i})(),children:[]}];let y=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[T.Bz.forChild(J),T.Bz]})}return i})(),Y=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[g.ez,y,d.u5]})}return i})()}}]);