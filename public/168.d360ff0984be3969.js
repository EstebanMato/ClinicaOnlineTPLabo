"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[168],{1168:(P,C,s)=>{s.r(C),s.d(C,{HomePacienteModule:()=>I});var u=s(6814),a=s(9517),h=s(5861),x=s(2572),m=s(7398),E=s(3519),r=s.n(E),t=s(5879),f=s(9113),d=s(588),l=s(6223),g=s(154);function T(o,b){1&o&&(t.TgZ(0,"div",12),t._UZ(1,"div",13),t.qZA())}function _(o,b){if(1&o){const e=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,c=t.oxw();return t.KtG(c.cancelarTurno(n))}),t._uU(1,"Cancelar "),t.qZA()}}function Z(o,b){if(1&o){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,c=t.oxw();return t.KtG(c.calificarTurno(n))}),t._uU(1,"Calificar "),t.qZA()}}function A(o,b){if(1&o){const e=t.EpF();t.TgZ(0,"span",21)(1,"i",22),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,c=t.oxw();return t.KtG(c.verComentariosTurno(n))}),t.qZA()()}}function U(o,b){if(1&o&&(t.TgZ(0,"tr")(1,"td")(2,"p",14),t._uU(3),t.qZA()(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td")(11,"span",15),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t.YNc(14,_,2,0,"button",16),t.YNc(15,Z,2,0,"button",17),t.qZA(),t.TgZ(16,"td"),t.YNc(17,A,2,0,"span",18),t.qZA()()),2&o){const e=b.$implicit,i=t.oxw();t.xp6(3),t.Oqu(e.nombreEspecialista),t.xp6(2),t.hij(" ",e.fecha," "),t.xp6(2),t.hij(" ",e.horaInicio," "),t.xp6(2),t.hij(" ",e.especialidad," "),t.xp6(2),t.Q6J("ngClass",i.getColorPorEstado(e.estado)),t.xp6(1),t.hij(" ",e.estado," "),t.xp6(2),t.Q6J("ngIf","pendiente"===e.estado||"confirmado"===e.estado),t.xp6(1),t.Q6J("ngIf","finalizado"===e.estado&&""===e.calificacion),t.xp6(2),t.Q6J("ngIf",""!==e.comentarios&&void 0!==e.comentarios||""!==e.resenia&&void 0!==e.resenia)}}const L=[{path:"",component:(()=>{class o{constructor(e,i,n,c){this.turnoService=e,this.dataquery=i,this.formBuilder=n,this.authService=c,this.isLoading=!1}ngOnInit(){this.filtroForm=this.formBuilder.group({especialista:[""],especialidad:[""]}),this.isLoading=!0;const e=this.turnoService.getTurnos(),i=this.turnoService.getEspecialistas();this.authService.getLoggedUser().subscribe(n=>{this.usuarioLogueado=n}),(0,x.a)([e,i,this.authService.getLoggedUser()]).pipe((0,m.U)(([n,c,p])=>n.filter(v=>v.uidPaciente===p?.uid).map(v=>{const y=c.find(J=>J.uid===v.uidEspecialista);return{...v,nombreEspecialista:y?`${y.apellido}, ${y.nombre}`:"Especialista no encontrado"}}))).subscribe(n=>{this.turnosDetallado=n,this.turnosFiltrado=this.turnosDetallado,this.isLoading=!1}),this.formSubscription=this.filtroForm.valueChanges.subscribe(n=>{this.turnosFiltrado=this.filtrarTurnos(this.turnosDetallado,n)})}filtrarTurnos(e,i){return e&&"string"==typeof i.especialidad?e.filter(n=>{const c="string"==typeof n.especialidad&&n.especialidad.toLowerCase().includes(i.especialidad?.toLowerCase()),p="string"==typeof n.nombreEspecialista&&n.nombreEspecialista.toLowerCase().includes(i.especialista?.toLowerCase());return c&&p}):[]}getColorPorEstado(e){switch(e){case"confirmado":return"badge rounded-pill text-bg-success";case"finalizado":return"badge rounded-pill text-bg-warning";case"cancelado":case"rechazado":return"badge rounded-pill text-bg-danger";case"pendiente":return"badge rounded-pill text-bg-secondary";default:return"badge rounded-pill text-bg-muted"}}cancelarTurno(e){var n,i=this;r().fire({title:"\xbfDesea cancelar?",input:"text",inputPlaceholder:"Ingrese el motivo de la cancelaci\xf3n",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"S\xed, cancelar",showLoaderOnConfirm:!0,preConfirm:(n=(0,h.Z)(function*(c){console.log(e.id,c),i.turnoService.cancelarTurno(e.id,c)}),function(p){return n.apply(this,arguments)}),allowOutsideClick:()=>!r().isLoading()}).then(n=>{n.isConfirmed&&r().fire("Cancelado","La acci\xf3n fue cancelada.","success")})}calificarTurno(e){var n,i=this;r().fire({title:"Calificar atenci\xf3n",input:"text",html:'<input type="range" id="calificacion" name="calificacion" min="1" max="5">',inputPlaceholder:"\xbfComo estuvo la atenci\xf3n?",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Aceptar",showLoaderOnConfirm:!0,preConfirm:(n=(0,h.Z)(function*(c){const p=document.getElementById("calificacion").value;console.log(e.id,c,p),i.turnoService.calificarTurno(e.id,c,p)}),function(p){return n.apply(this,arguments)}),allowOutsideClick:()=>!r().isLoading()}).then(n=>{n.isConfirmed&&r().fire("Gracias","Se envio la calificaci\xf3n","success")})}verComentariosTurno(e){let i=`\n      <p><strong>Comentarios:</strong> ${e.comentarios}</p>\n      \n    `;""!==e.resenia&&(i+=`\n      <p><strong>Rese\xf1a:</strong> ${e.resenia}</p>\n      `),""!==e.calificacion&&(i+=`\n        <label for="calificacion">Calificaci\xf3n:</label>\n        <input type="range" id="calificacion" name="calificacion" min="1" max="5" value="${e.calificacion}" disabled>\n      `),r().fire({title:"Comentarios",html:i,confirmButtonText:"Cerrar",allowOutsideClick:()=>!r().isLoading()})}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(f.D),t.Y36(d.e),t.Y36(l.qu),t.Y36(g.e))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-home-paciente"]],decls:32,vars:3,consts:[["class","overlay",4,"ngIf"],[1,"turnos-container"],[3,"formGroup"],[1,"filtro-container"],["for","especialista"],["type","text","formControlName","especialista"],["for","especialidad"],["type","text","formControlName","especialidad"],["routerLink","turno/",1,"btn-danger","btn-sm","btn-nuevo-turno"],[1,"table","align-middle","mb-0","bg-white"],[1,"bg-light"],[4,"ngFor","ngForOf"],[1,"overlay"],[1,"spinner"],[1,"fw-normal","mb-1"],[3,"ngClass"],["type","button","class","btn btn-outline-danger btn-sm",3,"click",4,"ngIf"],["type","button","class","btn btn-outline-warning btn-sm",3,"click",4,"ngIf"],["class","d-flex justify-content-center",4,"ngIf"],["type","button",1,"btn","btn-outline-danger","btn-sm",3,"click"],["type","button",1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"d-flex","justify-content-center"],[1,"fas","fa-eye","text-muted",3,"click"]],template:function(i,n){1&i&&(t.YNc(0,T,2,0,"div",0),t.TgZ(1,"div",1)(2,"form",2)(3,"div",3)(4,"label",4),t._uU(5,"Especialista:"),t.qZA(),t._UZ(6,"input",5),t.TgZ(7,"label",6),t._uU(8,"Especialidad:"),t.qZA(),t._UZ(9,"input",7),t.TgZ(10,"button",8),t._uU(11,"Nuevo Turno"),t.qZA()(),t.TgZ(12,"table",9)(13,"thead",10)(14,"tr")(15,"th"),t._uU(16,"Especialista"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Fecha"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"Hora"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"Especialidad"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Estado"),t.qZA(),t.TgZ(25,"th"),t._uU(26,"Accion"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Comentarios"),t.qZA()()(),t.TgZ(29,"tbody"),t.YNc(30,U,18,9,"tr",11),t._UZ(31,"tr"),t.qZA()()()()),2&i&&(t.Q6J("ngIf",n.isLoading),t.xp6(2),t.Q6J("formGroup",n.filtroForm),t.xp6(28),t.Q6J("ngForOf",n.turnosFiltrado))},dependencies:[u.mk,u.sg,u.O5,a.rH,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u],styles:[".overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#fffc;display:flex;align-items:center;justify-content:center;z-index:9999}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #e64141;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 2s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.filtro-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:10px}.btn-nuevo-turno[_ngcontent-%COMP%]{position:absolute;right:0;margin-right:40px;margin-top:5px}"]})}return o})(),children:[]},{path:"turno",loadChildren:()=>s.e(17).then(s.bind(s,17)).then(o=>o.TurnoPacienteModule)}];let O=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[u.ez,a.Bz.forChild(L),a.Bz]})}return o})(),I=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[u.ez,O,l.u5,l.UX]})}return o})()},588:(P,C,s)=>{s.d(C,{e:()=>x});var u=s(5861),a=s(5349),h=s(5879);let x=(()=>{class m{constructor(r){this.firestore=r}getObraSociales(){const r=(0,a.hJ)(this.firestore,"obrasSociales");return(0,a.BS)(r)}getEspecialidades(){const r=(0,a.hJ)(this.firestore,"especialidades");return(0,a.BS)(r)}getProxIdEspecialidades(){var r=this;return(0,u.Z)(function*(){const t=(0,a.hJ)(r.firestore,"especialidades"),f=(0,a.IO)(t,(0,a.Xo)("id","desc")),d=yield(0,a.PL)(f);return d.empty?1:d.docs[0].get("id")+1})()}altaEspecialidad(r){var t=this;return(0,u.Z)(function*(){const f=yield t.getProxIdEspecialidades(),d=(0,a.hJ)(t.firestore,"especialidades");(0,a.ET)(d,{id:f,nombre:r.toLowerCase()})})()}traerUsuarios(){const r=(0,a.hJ)(this.firestore,"usuarios");return(0,a.BS)(r)}getPacientes(){var r=this;return(0,u.Z)(function*(){const t=(0,a.hJ)(r.firestore,"usuarios"),f=(0,a.IO)(t,(0,a.ar)("perfil","==","paciente")),d=yield(0,a.PL)(f),l=[];return d.forEach(g=>{l.push(g.data())}),l})()}cambiarEstadoUsuario(r,t){var f=this;return(0,u.Z)(function*(){const d=(0,a.hJ)(f.firestore,"usuarios"),l=(0,a.IO)(d,(0,a.ar)("uid","==",r)),g=yield(0,a.PL)(l);return 0!==g.size&&(g.forEach(function(){var T=(0,u.Z)(function*(_){const Z=_.ref;yield(0,a.pl)(Z,{estado:t},{merge:!0})});return function(_){return T.apply(this,arguments)}}()),!0)})()}static#t=this.\u0275fac=function(t){return new(t||m)(h.LFG(a.gg))};static#e=this.\u0275prov=h.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()}}]);